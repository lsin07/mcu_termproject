# Integrated Automotive Controller and Cluster Display System
**차량용 통합 제어기 및 클러스터 디스플레이 시스템 설계**  

## 주제 선정 동기

S32K144가 원래 자동차용 제어기 보드니까 자동차용 제어기를 만들어보았다..!

## 제어 모듈

제어 모듈은 항상 실행되는 모듈과 타이머 동작에 맞추어 실행되는 모듈, 그리고 인터럽트가 걸렸을 때만 동작하는 모듈로 구분됨.

### Throttle
항상 실행됨  
DC 모터, 가변저항 사용  
가변저항 값 읽어와서 듀티사이클 조정  
기어 모드에 따라 D 4000 ~ 0 사이, 4000 ~ 8000 사이로 PWM 제어하여 앞 뒤 양방향으로 갈 수 있도록 함.

### Sensor
타이머에 동기화됨 (10us 주기에 맞춰야함)  
+ 초음파 센서 동작 원리:  

    1. 60ms마다 최소 10us 길이의 TRIG HIGH 신호 입력
    2. TRIG 신호가 감지되면 자체적으로 8번의 초음파 펄스 생성
    3. 초음파 펄스가 끝나면, 반사된 초음파가 도착할 때까지 ECHO가 set됨
    4. ECHO HIGH 시간이 길수록 물체가 멀리 있는것.

1. 10us마다 LPIT 인터럽트 신호 생성. TRIG 주기는 60ms이므로 인터럽트 신호가 6000번 생성되면 1주기가 실행된 것임.

2. 매 주기의 첫 실행에 TRIG SET, 두 번째 실행에 TRIG CLEAR 하면 10us 길이의 신호가 생성됨

3. ISR이 1주기(6000번) 실행되는 동안, ECHO HIGH일 때 high counter를 1 증가시킴.

4. 그러면 1주기가 끝난 이후 high counter의 값은 거리와 비례함.  
주기가 끝나면 high counter의 값 리셋

### Alarm
타이머에 동기화됨 (주기적으로 버저음 생성하는 기능 구현에 필요)  
센서가 읽어온 값에 따라 작동.

센서 값이 작아질수록 (=가까워질수록) 버저음이 켜졌다 꺼지는 주기가 빨라짐  
너무 가까우면 계속 켜진 상태 유지

### Blinker
타이머에 동기화됨 (0.5초마다 깜빡여야 함)  
깜빡이가 작동되면 일정 시간마다 램프 제어 신호 생성

### Lamp
항상 실행됨  
전조등, 방향지시등, 후진등, 제동등 제어  
방향지시등 제어 신호는 blinker 모듈에서 생성되고, 나머지 제어는 자체적으로 진행함  

전조등은 실습키트 led 사용하여 차폭등 (2개 점등), 전조등 (4개 점등), 자동 모드로 구분됨.  
전조등 모드가 Auto일 때는 Cds 센서에서 값 읽어서 전조등 제어  

후진등은 온보드 yellow(red+green) LED 사용하여 기어 R 일때, 제동등 온보드 red LED 사용하여 (일단은) 기어 P 일때 점등됨.

### Panel
버튼 인터럽트가 걸렸을 때만 실행됨  
버튼이 눌리면 인터럽트를 통해 기어, 램프, 깜빡이 등등 전역 변수 값 설정

### UART
타이머에 동기화됨 (0.1초마다 디스플레이 정보 전송함)  
1번에 4바이트 정보 전송  
구조체 bit field 사용하여, LSB부터
* 2: lamp  
* 2: gear  
* 2: blinker  
* 10: speed

와 같이 구성.

### Dashboard

PC에서 PySerial로 보드와 직렬 통신하여 디스플레이 정보 수신  
PyQt로 GUI 구동하여 계기판 화면 구현
